ktor {
    deployment {
        port = 8080
        port = ${?PORT}
    }
    application {
        modules = [ ru.sber.cb.aichallenge_one.ApplicationKt.module ]
    }
}

gigachat {
    baseUrl = "https://gigachat.devices.sberbank.ru/api/v1"
    authUrl = "https://ngw.devices.sberbank.ru:9443/api/v2/oauth"
    clientId = ${?GIGACHAT_CLIENT_ID}
    clientSecret = ${?GIGACHAT_CLIENT_SECRET}
    scope = "GIGACHAT_API_PERS"
}

# OpenAI-compatible API configuration (optional)
# Supports OpenAI, Azure OpenAI, LocalAI, Ollama with OpenAI compatibility, etc.
openai {
    # Base URL for the API (e.g., "https://api.openai.com/v1" for OpenAI)
    baseUrl = "https://openrouter.ai/api/v1"

    # Model name (e.g., "gpt-4", "gpt-3.5-turbo", "gpt-4-turbo")
    model = ${?OPENAI_MODEL}
    # Top-p sampling parameter (optional, 0.0-1.0)
    topP = ${?OPENAI_TOP_P}
}

ollama {
  baseUrl = "http://localhost:11434"
  baseUrl = ${?OLLAMA_BASE_URL}
  model = "gemma3:1b"
  model = ${?OLLAMA_MODEL}
  timeout = 120000  # 2 minutes
  timeout = ${?OLLAMA_TIMEOUT}
  enableSummarization = false
  enableSummarization = ${?OLLAMA_ENABLE_SUMMARIZATION}
  enableTools = true
  enableTools = ${?OLLAMA_ENABLE_TOOLS}
  streamFlushInterval = 50
  streamFlushInterval = ${?OLLAMA_STREAM_FLUSH_INTERVAL}
}

database {
    url = "jdbc:postgresql://localhost:5432/aichallenge"
    url = ${?DATABASE_URL}
    driver = "org.postgresql.Driver"
    user = "aichallenge"
    user = ${?DATABASE_USER}
    password = "aichallenge"
    password = ${?DATABASE_PASSWORD}
    maxPoolSize = 10
}

# Whisper STT Configuration (local)
whisper {
  # Command to execute (must be in PATH)
  command = "whisper"
  command = ${?WHISPER_COMMAND}

  # Model size: tiny, base, small, medium, large
  model = "small"
  model = ${?WHISPER_MODEL}

  # Language code (Russian for this project)
  language = "Russian"
  language = ${?WHISPER_LANGUAGE}

  # Task type: transcribe (keep original) or translate (to English)
  task = "transcribe"
  task = ${?WHISPER_TASK}

  # Output format: txt, json, srt, vtt
  outputFormat = "txt"
  outputFormat = ${?WHISPER_OUTPUT_FORMAT}

  # Device: cuda, cpu, or auto (default: auto)
  device = "cpu"
  device = ${?WHISPER_DEVICE}

  # Execution timeout in seconds (default: 120)
  timeout = 120
  timeout = ${?WHISPER_TIMEOUT}

  # Temp directory for audio files (relative to project root)
  tempDir = "temp"
  tempDir = ${?WHISPER_TEMP_DIR}

  # Max audio file size in bytes (25 MB)
  maxFileSize = 26214400
  maxFileSize = ${?WHISPER_MAX_FILE_SIZE}

  # Max audio duration in seconds
  maxDuration = 30
  maxDuration = ${?WHISPER_MAX_DURATION}

  # Character encoding for stdout parsing (UTF-8)
  encoding = "UTF-8"
  encoding = ${?WHISPER_ENCODING}
}

# ffmpeg Configuration
ffmpeg {
  # Command to execute (must be in PATH)
  command = "ffmpeg"
  command = ${?FFMPEG_COMMAND}

  # Input format (from browser)
  inputFormat = "webm"
  inputFormat = ${?FFMPEG_INPUT_FORMAT}

  # Output format for Whisper
  outputFormat = "wav"
  outputFormat = ${?FFMPEG_OUTPUT_FORMAT}

  # Audio parameters (16kHz, mono, 16-bit PCM - Whisper standard)
  sampleRate = 16000  # Hz
  sampleRate = ${?FFMPEG_SAMPLE_RATE}

  channels = 1        # mono
  channels = ${?FFMPEG_CHANNELS}

  bitDepth = 16       # 16-bit PCM
  bitDepth = ${?FFMPEG_BIT_DEPTH}

  # Execution timeout in seconds
  timeout = 30
  timeout = ${?FFMPEG_TIMEOUT}
}
