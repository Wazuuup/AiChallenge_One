# Быстрый старт - Развертывание MCP Server

## Шаг 1: Настройка SSH ключа (один раз)

Запустите скрипт для настройки SSH аутентификации без пароля:

```bash
setup-ssh-key.bat
```

**Что происходит:**

- Генерируется SSH ключ (если его нет)
- Ключ копируется на сервер (вам нужно будет ввести пароль один раз)
- Проверяется подключение

**Результат:** После этого вы сможете подключаться к серверу без ввода пароля

---

## Шаг 2: Развертывание сервера

После настройки SSH ключа запустите развертывание:

```bash
deploy-mcp-server-simple.bat
```

**Что происходит:**

1. Сборка mcp-server локально
2. Создание архива
3. Передача файлов на сервер (БЕЗ запроса пароля)
4. Установка Java на сервере (если нужно)
5. Остановка старой версии
6. Развертывание новой версии
7. Запуск сервера

**Результат:** Сервер работает на:

- HTTP: http://89.124.67.120:8082
- HTTPS: https://89.124.67.120:8443

---

## Управление сервером

### Проверить статус

```bash
check-status.bat
```

### Просмотр логов

```bash
# Последние 50 строк
view-logs.bat

# Последние 100 строк
view-logs.bat 100

# Режим реального времени
view-logs.bat live
```

### Остановить сервер

```bash
stop-mcp-server.bat
```

### Повторное развертывание

```bash
deploy-mcp-server-simple.bat
```

---

## Тестирование сервера

```bash
# HTTP endpoint
curl http://89.124.67.120:8082

# HTTPS endpoint (самоподписанный сертификат)
curl -k https://89.124.67.120:8443
```

---

## Полезные команды SSH

### Подключение к серверу

```bash
ssh mcp@89.124.67.120
```

### Просмотр логов напрямую

```bash
ssh mcp@89.124.67.120 "tail -f /home/mcp/mcp-server/logs/server.log"
```

### Проверка процесса

```bash
ssh mcp@89.124.67.120 "ps aux | grep mcp-server"
```

### Остановка сервера напрямую

```bash
ssh mcp@89.124.67.120 "kill $(cat /home/mcp/mcp-server/mcp-server.pid)"
```

---

## Структура файлов на сервере

```
/home/mcp/mcp-server/
├── bin/mcp-server           # Исполняемый файл
├── lib/                     # JAR библиотеки
├── logs/server.log          # Логи приложения
└── mcp-server.pid           # ID процесса
```

---

## Решение проблем

### Сервер не запускается

1. Проверьте логи: `view-logs.bat`
2. Проверьте, установлена ли Java: `ssh mcp@89.124.67.120 "java -version"`
3. Проверьте, свободны ли порты: `ssh mcp@89.124.67.120 "netstat -tuln | grep -E '8082|8443'"`

### Порты недоступны извне

Проверьте firewall на сервере:

```bash
ssh mcp@89.124.67.120 "sudo ufw status"
ssh mcp@89.124.67.120 "sudo ufw allow 8082/tcp"
ssh mcp@89.124.67.120 "sudo ufw allow 8443/tcp"
```

### SSH ключ не работает

Проверьте права доступа:

```bash
ssh mcp@89.124.67.120 "chmod 700 ~/.ssh && chmod 600 ~/.ssh/authorized_keys"
```

---

## Первое развертывание (пошагово)

```bash
# 1. Настройка SSH (один раз)
setup-ssh-key.bat
# Введите пароль когда попросит

# 2. Развертывание
deploy-mcp-server-simple.bat
# Подождите 2-5 минут

# 3. Проверка
check-status.bat

# 4. Тестирование
curl http://89.124.67.120:8082
```

Готово!
